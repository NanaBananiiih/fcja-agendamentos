{% extends "base.html" %}
{% block title %}Agendar — {{ tipo|capitalize }}{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-12 col-lg-8">
    <div class="card shadow-sm">
      <div class="card-body p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h1 class="h4 mb-0">Agendar — {{ tipo|capitalize }}</h1>
          <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('index') }}">← Voltar</a>
        </div>

        <form method="post" action="{{ url_for('agendar_submit', tipo=tipo) }}" class="row g-3 needs-validation" novalidate>
          {% if tipo == 'visitante' %}
            {% include 'partials/_visitante_fields.html' %}
          {% elif tipo == 'escola' %}
            {% include 'partials/_escola_fields.html' %}
          {% elif tipo == 'ies' %}
            {# partial corrigido: templates/partials/_ies_fields.html (representante em vez de responsavel) #}
            {% include 'partials/_ies_fields.html' %}
          {% elif tipo == 'pesquisador' %}
            {% include 'partials/_pesquisador_fields.html' %}
          {% endif %}

          <div class="col-12">
            <button class="btn btn-primary px-4" type="submit">Enviar agendamento</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block body_extra %}
<script>
  // Validação Bootstrap (client-side)
  (() => {
    const forms = document.querySelectorAll('.needs-validation');
    Array.from(forms).forEach(form => {
      form.addEventListener('submit', event => {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  })();
</script>
{% endblock %}